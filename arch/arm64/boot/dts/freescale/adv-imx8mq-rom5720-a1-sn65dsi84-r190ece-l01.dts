/*
 * Copyright 2018 NXP
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

#include "adv-imx8mq-rom5720-a1.dts"
#include <dt-bindings/display/drm_mipi_dsi.h>

/ {
	display-subsystem {
		status = "okay";
	};

	sound {
		status = "disabled";
	};

	sound-hdmi {
		status = "disabled";
	};

	pcm5102a: pcm5102a {
		compatible = "ti,pcm5102a";
		#sound-dai-cells = <0>;
		clocks = <&clk IMX8MQ_CLK_SAI2_ROOT>;
		clock-names = "mclk";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_sai2_mclk>;
		status = "okay";
	};

	sound-pcm5102a {
		compatible = "simple-audio-card";
		simple-audio-card,format = "i2s";
		simple-audio-card,name = "pcm5102a-hifi";
		simple-audio-card,mclk-fs = <256>;
		status = "okay";

		simple-audio-card,cpu {
			sound-dai = <&sai2>;
		};
		simple-audio-card,codec {
			sound-dai = <&pcm5102a>;
		};
	};

	backlight: backlight {
		compatible = "pwm-backlight";
		pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_lcd0>;
        lvds-vcc-enable = <&gpio5 6 1>;
        bklt-vcc-enable = <&gpio1 3 1>;
        lvds-bkl-enable = <&gpio1 15 1>;
        lvds-bkl-delay-time = <0>;
        bklt-pwm-delay-time = <100>;
        bklt-en-delay-time = <10>;
		pwms = <&pwm1 0 5000000 0>;
		brightness-levels = < 0  1  2  3  4  5  6  7  8  9
			     10 11 12 13 14 15 16 17 18 19
			     20 21 22 23 24 25 26 27 28 29
			     30 31 32 33 34 35 36 37 38 39
			     40 41 42 43 44 45 46 47 48 49
			     50 51 52 53 54 55 56 57 58 59
			     60 61 62 63 64 65 66 67 68 69
			     70 71 72 73 74 75 76 77 78 79
			     80 81 82 83 84 85 86 87 88 89
			     90 91 92 93 94 95 96 97 98 99
			    100>;
		default-brightness-level = <80>;
		status = "okay";
	};

	gpio_adv {
		compatible = "misc-adv-gpio";
		status = "okay";
	};
};

&hdmi {
	status = "okay";
};

&codec {
	status = "disabled";
};

&sai2 {
	#sound-dai-cells = <0>;
	clocks = <&clk IMX8MQ_CLK_SAI2_IPG>,
			<&clk IMX8MQ_CLK_DUMMY>,
			<&clk IMX8MQ_CLK_SAI2_ROOT>,
			<&clk IMX8MQ_CLK_DUMMY>,
			<&clk IMX8MQ_CLK_DUMMY>,
			<&clk IMX8MQ_AUDIO_PLL1_OUT>,
			<&clk IMX8MQ_AUDIO_PLL2_OUT>;
	clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3", "pll8k", "pll11k";
	status = "okay";
};

&sai3 {
	status = "disabled";
};

&sai4 {
	status = "disabled";
};

&i2c2 {
	dsi_lvds_bridge: sn65dsi84@2c{
		reg = <0x2c>;
		status = "okay";
		compatible = "ti,sn65dsi84";

		sn65dsi84,addresses = <	0x09 0x0A 0x0B 0x0D 0x10 0x11 0x12 0x13
					0x18 0x19 0x1A 0x1B 0x20 0x21 0x22 0x23
					0x24 0x25 0x26 0x27 0x28 0x29 0x2A 0x2B
					0x2C 0x2D 0x2E 0x2F 0x30 0x31 0x32 0x33
					0x34 0x35 0x36 0x37 0x38 0x39 0x3A 0x3B
					0x3C 0x3D 0x3E 0x0D 0x09>;

		sn65dsi84,values =    <	0x01 0x03 0x28 0x00 0x26 0x00 0x40 0x00
					0x6c 0x00 0x03 0x00 0x00 0x05 0x00 0x00
					0x00 0x00 0x00 0x00 0x21 0x00 0x00 0x00
					0x64 0x00 0x00 0x00 0x1e 0x00 0x00 0x00
					0x50 0x00 0x00 0x00 0x00 0x00 0x00 0x00
					0x00 0x00 0x00 0x01 0x00>;
		port {
			sn65dsi84_in: endpoint {
				remote-endpoint = <&mipi_dsi_bridge_out>;
			};
		};
	};
};

&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_hog>;
	imx8mq-evk {
		pinctrl_lcd0: lcd0grp {
			fsl,pins = <
				MX8MQ_IOMUXC_ECSPI1_SCLK_GPIO5_IO6	0x19		/* LCD0_VDD_EN */
				MX8MQ_IOMUXC_GPIO1_IO03_GPIO1_IO3	0x19		/* LCD0_BKLT_VDD_EN */
				MX8MQ_IOMUXC_GPIO1_IO15_GPIO1_IO15	0x19		/* LCD0_BKLT_EN */
			>;
		};
		pinctrl_pwm1: pwm1grp {
			fsl,pins = <
				MX8MQ_IOMUXC_GPIO1_IO01_PWM1_OUT         0x06
			>;
		};
	};
};

&pwm1 {
 	status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm1>;
};

&lcdif {
	status = "okay";
	max-res = <1280>, <1024>;

	port@0 {
		lcdif_mipi_dsi: mipi-dsi-endpoint {
			remote-endpoint = <&mipi_dsi_in>;
		};
	};
};

&irqsteer_dcss {
	status = "okay";
};

&dcss {
 	status = "okay";
};

&mipi_dsi_phy {
	status = "okay";
};

&mipi_dsi {
	status = "okay";
	as_bridge;
	sync-pol = <1>;
	pwr-delay = <10>;

	port@1 {
		mipi_dsi_in: endpoint {
			remote-endpoint = <&lcdif_mipi_dsi>;
		};
	};
};

&mipi_dsi_bridge {
	status = "okay";

	panel@0 {
		compatible = "simple-panel-dsi";
		reg = <0>;
		//backlight = <&backlight>;
		dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST |
					MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)>;
        dsi,format = <MIPI_DSI_FMT_RGB888>;
        dsi,lanes = <4>; 
        bus-format = <0x100a>;
        bus-flags = <10>;
		panel-init-sequence = [
						29 00 06 09 00 00 00 00 01 
						29 00 06 0A 00 00 00 00 03 
						29 00 06 0B 00 00 00 00 28 
						29 00 06 0D 00 00 00 00 00 
						29 00 06 10 00 00 00 00 26 
						29 00 06 11 00 00 00 00 00 
						29 00 06 12 00 00 00 00 40 
						29 00 06 13 00 00 00 00 00 
						29 00 06 18 00 00 00 00 6c 
						29 00 06 19 00 00 00 00 00 
						29 00 06 1A 00 00 00 00 03 
						29 00 06 1B 00 00 00 00 00 
						29 00 06 20 00 00 00 00 00 
						29 00 06 21 00 00 00 00 05 
						29 00 06 22 00 00 00 00 00 
						29 00 06 23 00 00 00 00 00 
						29 01 06 24 00 00 00 00 00 
						29 00 06 25 00 00 00 00 00 
						29 00 06 26 00 00 00 00 00 
						29 00 06 27 00 00 00 00 00 
						29 00 06 28 00 00 00 00 21 
						29 00 06 29 00 00 00 00 00 
						29 00 06 2A 00 00 00 00 00 
						29 00 06 2B 00 00 00 00 00 
						29 00 06 2C 00 00 00 00 64 
						29 00 06 2D 00 00 00 00 00 
						29 00 06 2E 00 00 00 00 00 
						29 00 06 2F 00 00 00 00 00 
						29 00 06 30 00 00 00 00 1e 
						29 00 06 31 00 00 00 00 00 
						29 00 06 32 00 00 00 00 00 
						29 00 06 33 00 00 00 00 00 
						29 00 06 34 00 00 00 00 50 
						29 00 06 35 00 00 00 00 00 
						29 00 06 36 00 00 00 00 00 
						29 00 06 37 00 00 00 00 00 
						29 00 06 38 00 00 00 00 00 
						29 00 06 39 00 00 00 00 00 
						29 00 06 3A 00 00 00 00 00 
						29 00 06 3B 00 00 00 00 00 
						29 00 06 3C 00 00 00 00 00 
						29 00 06 3D 00 00 00 00 00 
						29 00 06 3E 00 00 00 00 00 
						29 00 06 0D 00 00 00 00 01 
						29 00 06 09 00 00 00 00 00 
					];

		display-timings {
			native-mode = <&timing0>;
			timing0: timing0 {
        		 clock-frequency = <108000000>;
        		 hactive = <1280>;
        		 vactive = <1024>;
        		 hback-porch = <188>;
        		 hfront-porch = <200>;
        		 vback-porch = <12>;
        		 vfront-porch = <30>;
        		 hsync-len = <10>;
        		 vsync-len = <10>;
        		 hsync-active = <0>;
        		 vsync-active = <0>;
        		 de-active = <0>;
        		 pixelclk-active = <0>;
			 };
		};
	};

	port@1 {
		mipi_dsi_bridge_out: endpoint {
			remote-endpoint = <&sn65dsi84_in>;
		};
	};
};
